#!/usr/bin/env ruby
# frozen_string_literal: true

require_relative '../lib/floss'

module Cli
  attr_accessor :action, :verbose, :args

  def self.options
    require 'optparse'

    OptionParser.new do |parser|
      parser.banner = 'Easily manage floss repositories.'

      parser.on('-v', '--verbose', 'More information') do
        @verbose = true
      end

      parser.on('-i', '--info', 'Floss current version') do
        @action = :info
      end

      parser.on('-g', '--grab', 'Grab floss projects') do
        @action = :grab
      end

      parser.on('-a', '--archive NAMES', 'Archive floss projects on list of NAMES') do |names|
        @names = names
        @action = :archive
      end
    end
  end

  def self.start
    options.parse! ['--help'] if ARGV.empty?

    begin
      options.parse!
    rescue OptionParser::MissingArgument
      puts <<~ERROR
        --archive NAMES

        Missing NAMES of projects!'
      ERROR
    end

    Floss::Main.new(@action, @names, @verbose).run
  end
end

Cli.start
