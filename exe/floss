#!/usr/bin/env ruby
# frozen_string_literal: true

require_relative '../lib/floss'

module Cli
  attr_accessor :action, :verbose, :args

  def self.options
    require 'optparse'

    OptionParser.new do |parser|
      parser.banner = 'Easily manage floss repositories.'

      parser.on('-i', '--info', 'project information') do
        print Floss::VERSION
        exit!
      end

      parser.on('-g', '--grab', 'grab floss projects') do
        @action = :grab
      end

      parser.on('-a', '--archive NAMES', Array, 'archive floss projects listed on NAMES') do |names|
        @names = names
        @action = :archive
      end

      parser.on('-v', '--verbose', 'more information') do
        @verbose = true
      end
    end
  end

  def self.start
    options.parse! ['--help'] if ARGV.empty?

    begin
      options.parse!
    rescue OptionParser::MissingArgument
      puts <<~ERROR
        --archive NAMES

        Missing NAMES of projects!'
      ERROR
      exit!
    rescue OptionParser::InvalidOption
      options.parse! ['--help']
    end

    Floss::Main.new(@action, @names, @verbose).run
  end
end

Cli.start
